---
name: test-driven-development
description: 在实施任何功能或修复 Bug 之前使用，必须在编写实施代码之前编写测试。
---

# 测试驱动开发 (Test Driven Development)

## 概述

此技能强制执行严格的 TDD 红-绿-重构循环。

**核心原则：**
1.  **先红后绿**：没有失败的测试，就没有任何理由写任何一行生产代码。
2.  **最小实现**：只编写刚好能让测试通过的代码。
3.  **铁律**：未经测试的代码就是垃圾代码，必须立即删除。

## 何时使用

- 修复 Bug 时（先写重现测试）。
- 添加新功能时（先写功能测试）。
- 重构代码时（先确保现有测试通过）。
- **严禁**用于“探索性编码”或“原型设计”（除非在特定沙盒中）。

## 核心法则

### 1. 必须遵循 R-G-R 循环

你**必须**严格按照以下顺序操作，严禁跳步：

1.  **红 (Red)**：
    - 编写一个只测试**一个**特定行为的测试用例。
    - 运行测试。
    - **必须**看到它失败（并且失败原因符合预期）。
    - 提交代码：`git commit -m "test: expect failure for [feature]"`

2.  **绿 (Green)**：
    - 编写**最少量**的代码来让测试通过。哪怕是硬编码返回值也可以。
    - 运行测试。
    - **必须**看到它通过。
    - 提交代码：`git commit -m "feat: pass test for [feature]"`

3.  **重构 (Refactor)**：
    - 清理代码，消除重复，优化结构。
    - **必须**再次运行测试。
    - **必须**看到它依然通过。
    - 提交代码：`git commit -m "refactor: clean up [feature]"`

### 2. 严禁无测试代码

- 如果你写了一行生产代码，而没有对应的测试，**必须立即删除它**。
- **严禁**说“我稍后再补测试”。现在的你都没时间写，未来的你更没时间。
- 注释掉的代码不是测试。如果你不需要它，**必须**删除它。

### 3. 测试即文档

- 测试名称必须清晰描述行为（如 `should_return_error_when_user_not_found`）。
- **严禁**使用 `test1`, `test_function` 这种无意义的名称。
- 每一个 Bug 修复都**必须**伴随一个新的回归测试用例。

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “这个逻辑太简单了，不需要测” | 如果它很简单，那写个测试只需要 30 秒。如果它出错了，你会感谢这 30 秒。 |
| “我不知道怎么测这个 UI/DB” | 这是一个架构问题。把逻辑抽离出来，使它可测。 |
| “赶时间，以后再补” | TDD 是最快的开发方式。没有 TDD，你将在无休止的 `console.log` 和手动刷新中浪费所有时间。 |
| “我已经手动验证过了” | 手动验证是一次性的。自动化测试是永久的资产。 |

## 危险信号 (Red Flags)

如果出现以下情况，**立即停止**并删除刚才写的代码：

- 你连续写了 10 分钟生产代码，却没运行一次测试。
- 你先写了函数实现，然后才去写测试。 -> **删除实现，重新开始。**
- 测试失败了，你却修改了测试代码让它通过（而不是修改生产代码）。
- 你注释掉了失败的测试。