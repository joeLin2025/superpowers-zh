---
name: brainstorming
description: 当需要进行新功能开发、架构设计、重构或解决模糊问题，且需要将需求转化为具体的技术规范时使用。
---

# 深度脑暴与设计 (Deep Brainstorming & Design)

## 概述

此技能是将模糊需求转化为精准工程蓝图的“熔炉”。它强制在任何代码变更前进行结构化思考，旨在通过穷尽可能性、识别权衡（Trade-offs）和预判风险，消除架构级的重构隐患。

**核心原则：**
1.  **设计物化 (Materialized Design)**：脑暴的终点不是聊天记录，而是受版本控制的、可审计的规格说明书 (Spec)。
2.  **强制权衡 (Forced Trade-offs)**：拒绝接受“唯一方案”。必须通过对比不同维度的方案（如：复杂度 vs 扩展性）来证明当前决策的优越性。
3.  **副作用预判 (Side-effect Anticipation)**：必须在写代码前识别对现有模块的侵入范围。

## 何时使用

- 接收到涉及逻辑变动的新功能开发请求时。
- 准备进行跨模块重构或性能优化时。
- 面对“报错后不确定修复路径”的复杂系统问题时。
- **严禁使用于**：修复拼写错误、格式调整、极小的常量修改。

## 核心法则

### 1. 必须执行上下文深度扫描 (Context Audit)
在提出任何方案前，**必须**基于实时证据而非记忆进行审计：
- **动作**：使用 `list_directory` 确认目录结构，使用 `read_file` 提取关键逻辑片段。
- **约束**：**严禁**在没有引用实际代码路径和变量名的情况下进行讨论。引用必须准确到文件名。

### 2. 必须遵循“双重方案”铁律 (Dual-Path Requirement)
对于任何设计，**必须**至少提出 2 个具有本质差异的路径：
- **方案 A (推崇方案)**：当前认为最合理的路径。
- **方案 B (替代/激进/保守方案)**：如“不作为”、“极简实现”或“彻底重写”。
- **必须**使用表格对比两者的：**实现难度、维护成本、性能影响、风险点**。

### 3. 必须产出标准规格说明书 (Spec Output Standard)
脑暴的结论**必须**持久化为 `docs/specs/[YYYY-MM-DD]-[task-name].md`。
若目录不存在，必须使用 `run_shell_command` 创建 `mkdir -p docs/specs`。

**Spec 文档必须严格遵守以下 Schema：**

```markdown
# [Spec Title]

## 1. 背景与目标 (Context & Goals)
- **痛点**: [描述当前问题]
- **目标**: [定义成功的标准]
- **非目标 (Non-Goals)**: [明确不做的范围，防止蔓延]

## 2. 核心设计 (Core Design)
- **API 变更**: [函数签名 / 接口定义]
- **数据结构**: [Schema / Model 变更]
- **逻辑流**: [伪代码 / Mermaid 流程图]

## 3. 方案权衡 (Trade-offs)
| 维度 | 方案 A (推荐) | 方案 B (替代) |
| :--- | :--- | :--- |
| 复杂度 | 低 | 高 |
| 风险 | 无 | 可能破坏旧数据 |

## 4. 风险与副作用 (Risks & Side Effects)
- **受影响文件**: [必须列出具体文件路径]
- **破坏性变更**: [是否需要迁移数据？是否破坏 Public API？]
```

### 4. 严禁越权进入实施阶段 (No Implementation Leakage)
- **严禁**在脑暴阶段产出 `Writing-Plans` 级别的细粒度步骤。
- **严禁**产出超过 10 行的实现代码（除非是展示 API 签名的样板）。
- **熔断机制**：必须在 Spec 获得用户明确“批准 (Approved)”后，才能激活 `writing-plans`。

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “这个改动一眼就能看穿，不需要两个方案” | 人的第一反应往往带有偏见。强迫思考第二个方案能帮你发现隐藏的边缘情况。 |
| “我已经在对话里说得很详细了” | 对话历史是流动的、易失的。Spec 是静态的、确定的。没有 Spec 的开发是“盲人摸象”。 |
| “写文档会降低开发速度” | 架构错误的修复成本比写文档高 100 倍。磨刀不误砍柴工。 |

## 危险信号 (Red Flags)

- **直接给代码**：在没有产出 Spec 的情况下直接给出大量实现逻辑。
- **方案单一**：只有一种思路，且没有对比。
- **范围模糊**：没有明确定义 Non-Goals。
- **凭空想象**：设计的 Spec 中没有任何对现有代码库文件路径的引用。