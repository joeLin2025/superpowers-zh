---
name: verification-before-completion
description: 在声称修复完成、功能交付或准备提交代码前使用，确立“证据优先”的验收基准。
---

# 完工前验证 (Verification Before Completion)

## 概述

此技能是 Gemini CLI 的“质量终审权”。它确立了**事实胜于雄辩**的原则，禁止任何基于直觉或口头承诺的交付。所有的交付声明必须建立在可观察、可复现、且已持久化的验证证据之上。

**核心原则：**
1.  **证据即真理 (Evidence is Truth)**：没有日志支撑的断言一律视为幻觉。
2.  **穿透性阅读 (Penetrative Reading)**：严禁只看 `Exit Code: 0`。必须阅读日志细节以识别“静默失败”或潜在的 Deprecation 警告。
3.  **零死角扫描 (Zero-Blindspot Scan)**：核心功能的成功不代表全系统的安全。必须执行全量回归与 Lint 检查。

## 何时使用

- 准备在对话中宣告“Bug 已修复”或“功能已实现”前。
- 执行 `git commit` 或 `git push` 的动作前。
- 实施计划（Execution Plan）的所有步骤执行完毕，准备关闭任务前。
- **严禁使用于**：纯脑暴阶段、环境搭建过程中的临时调试。

## 核心法则

### 1. 强制执行“五步验证”规程
在给出任何肯定结论前，**必须**完整走完以下流程：
1.  **识别目标 (Targeting)**：明确本次验证的边界。是验证根因消失，还是验证全量通过？
2.  **运行验证 (Run)**：执行具体的测试命令或复现脚本。
3.  **副作用扫描 (Side-effect Scan)**：**必须**运行全量 Lint（如 `npm run lint`）和类型检查（如 `tsc`）。
4.  **深度审计 (Log Audit)**：逐行阅读输出日志，检查是否有未预料的副作用或残留的调试信息。
5.  **状态对齐 (Sync)**：核对 `writing-plans` 中的任务状态，确保记录了验证输出。

### 2. 建立差异化“验收标准”
| 交付类型 | 必须提供的证据 (Evidence) | 质量底线 (Baseline) |
| :--- | :--- | :--- |
| **Bug 修复** | 最小复现脚本从 Red 变为 Green 的完整日志。 | 无新回归错误 + 错误代码被彻底移除。 |
| **新功能** | 新增单元测试 + 集成测试的成功日志。 | 文档已更新 + 静态分析（Lint）无告警。 |
| **代码重构** | 原有全量测试套件 100% 通过的日志。 | 复杂度指标未恶化 + 性能无衰减。 |
| **构建修复** | 环境清理后的完整构建日志。 | 依赖关系已锁定。 |

### 3. 强制实施“证据物化”声明 (Output Standard)
在声称完成时，**必须**使用以下代码块格式进行最终交付（严禁口头承诺）：

```text
[交付声明]
----------------------------------------------------------------
1. 验证命令: [例如: npm test && npm run lint]
2. 核心证据:
   [粘贴关键日志片段，如: "Test Suites: 15 passed, 15 total"]
   [粘贴 Lint 成功日志，如: "All files passed checking"]
3. 完整性检查:
   [x] 无 console.log 残留
   [x] 无未跟踪的临时文件 (git status clean)
   [x] 计划文件已更新状态
----------------------------------------------------------------
结论: [任务已就绪，准备提交]
```

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “这个改动太微小了，没必要跑全量” | 往往是这些“微小”改动，因为缺乏关注而成为系统性崩溃的导火索。 |
| “环境里跑全量太慢，我已经点过了” | 你的感官是不可靠的。只有命令行的标准输出才是客观世界的真实反馈。 |
| “报错看起来跟我没关系” | 所有的报错在你负责的周期内都是你的责任。必须排除关联性，否则不能交付。 |

## 危险信号 (Red Flags)

- **口头担保**：使用“应该没问题了”、“我看过了”作为完工依据。
- **证据缺失**：在回复中没有提供任何命令行的输出内容。
- **选择性忽略**：只贴出了成功的断言，而忽略了下方明显的警告信息。
- **环境污染**：在存在未提交更改或未跟踪文件的情况下声称验证通过。