---
name: requesting-code-review
description: 当完成功能开发、修复 Bug 或准备合并分支时使用，以发起高质量的审查请求。
---

# 发起代码审查请求 (Requesting Code Review)

## 概述

此技能是将代码从“个人产出”转变为“团队资产”的质量契约。它通过**深度自我审计 (Self-Audit)** 和 **上下文注入 (Context Injection)**，确保审查者能够将注意力集中在架构和逻辑上，而非低级的语法或格式错误上。

**核心原则：**
1.  **自我审查是第一正义**：严禁提交自己未曾逐行审计过的差异（Diff）。你自己不尊重的代码，别人也不会尊重。
2.  **上下文完备性**：审查者不应对“为什么要这么改”产生疑惑。所有的背景、动机和决策过程必须在请求中显式说明。
3.  **零噪音交付**：在请求审查前，必须通过所有的自动化防线（Lint, Tests, Type Check）。

## 何时使用

- 完成了一个功能分支的开发，并已执行 `finishing-a-development-branch` 之后。
- 准备将本地变更合并到共享分支（如 `main`, `develop`）之前。
- 在 `subagent-driven-development` 流程中，主智能体调度审查者子智能体之前。

## 核心法则

### 1. 必须执行“差异审计” (Diff Auditing)
在发起请求前，**必须**执行 `git diff` 并逐行阅读：
- **逻辑自查**：每一行新增的代码是否都有存在的必要？是否有冗余？
- **死代码扫描**：是否遗留了调试时的 `TODO`, `print`, `debugger`？
- **命名规范**：新定义的变量和函数名是否能准确传达其意图？
- **铁律**：若连你自己都觉得“这部分写得有点绕”，必须先重构再请求审查。

### 2. 必须提供结构化描述 (Output Standard)
发起请求时，**必须**使用以下 Markdown 模板填充内容（严禁“Fix bug”一句话总结）：

```markdown
# PR 审查请求

## 1. 动机 (Why)
- **需求关联**: [Issue #123 / 功能需求描述]
- **目的**: [解决了什么痛点？]

## 2. 核心变更 (What)
- **逻辑**: [简述核心算法或流程的变动]
- **架构**: [新增了 Component X，修改了 Interface Y]

## 3. 风险点 (Risks)
- [ ] 破坏性变更 (Breaking Change)？
- [ ] 数据库迁移？
- [ ] 性能影响？

## 4. 验证证据 (Verification)
- **命令**: `npm test`
- **结果**: [粘贴成功的日志片段]
```

### 3. 必须确保变更原子化 (Atomic Changes)
- **规模限制**：单个审查请求的 Diff 建议不超过 300 行。
- **职责单一**：一个请求只解决一个问题。**严禁**在一个 PR 中同时进行“Bug 修复 + 架构重构 + 文档更新”。
- **拆分逻辑**：若变更过大，必须在描述中解释无法拆分的原因，或将其拆分为一系列逻辑连贯的原子请求。

### 4. 必须通过全量防御检查 (Gatekeeping)
- **动作**：必须在发起请求前最后一次运行 `npm test`（或同类命令）和 `lint`。
- **约束**：**严禁**让审查者指出本该由 Lint 工具发现的问题。这被视为对审查者时间的极度不尊重。

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “代码就在那里，他们看得懂” | 审查者的职责是挑战你的逻辑，而不是玩猜谜游戏。提供背景是作者的基本义务。 |
| “我赶时间，先合进去再说” | 赶时间导致的低质量代码会引发生产事故。事故处理的时间比审查长 100 倍。 |
| “这个 PR 虽然大，但逻辑很简单” | 大规模的变更会隐藏细小的 Bug。即使逻辑简单，也应按模块拆分以降低心智负担。 |
| “我不知道怎么写描述” | 描述就是你脑中设计思路的文字化。如果你写不出来，说明你还没想清楚。 |

## 危险信号 (Red Flags)

- **“空”描述**：审查请求中没有描述，或只有“Update”、“Fix”等无意义词汇。
- **携带脏数据**：变更中包含了非预期的配置文件修改或大量自动生成的代码。
- **未通过测试**：明知有测试失败仍然发起审查请求。
- **逻辑大杂烩**：在一个请求中混杂了多个互不相关的逻辑变更。