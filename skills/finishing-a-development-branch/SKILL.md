---
name: finishing-a-development-branch
description: 当实施完成，所有测试通过，并且你需要决定如何集成工作时使用。
---

# 完成开发分支 (Finishing a Development Branch)

## 概述

此技能强制执行代码集成前的最终质量关卡。

**核心原则：**
1.  **无测试不集成**：所有的测试（包括旧的回归测试）必须全部通过。
2.  **清理现场**：删除临时文件、调试日志和无用的注释。
3.  **安全合并**：确保当前分支与主干同步，解决所有冲突。

## 何时使用

- 完成了 `brainstorming` -> `writing-plans` -> `TDD` 的整个实施流程后。
- 准备发起 Pull Request (PR) 或合并代码时。
- 认为任务已经“完成”时。

## 核心法则

### 1. 必须执行全量验证

在宣称“完成”之前，**必须**运行项目的完整测试套件：
- 不仅仅是你新写的测试，而是**所有**测试。
- 使用项目的标准验证命令（如 `npm test`, `cargo test`）。
- **严禁**在有任何测试失败的情况下继续。

### 2. 必须清理环境

- **必须**检查并删除所有临时的调试日志 (`console.log`, `print`).
- **必须**删除所有临时生成的测试文件。
- **必须**删除未使用的导入和注释掉的代码块。

### 3. 必须规范提交历史

- 使用 `git log` 检查最近的提交。
- 如果有 `fix typo`, `wip` 等无意义提交，**必须**使用 `git rebase -i` 进行合并或重写。
- **语言要求**：提交信息（Commit Message）的描述部分**必须**使用中文（除非项目明确禁止），但保留标准的英文前缀（如 `feat:`, `fix:`）。
- 确保每个提交信息都清晰描述了变更内容。

### 4. 必须同步主干

- 在合并前，**必须**拉取主干最新代码（`git fetch origin main`）。
- **必须**将当前分支变基或合并主干代码（`git rebase origin/main` 或 `git merge origin/main`）。
- **必须**解决所有冲突，并重新运行全量验证。

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “刚才那个测试失败是因为网络问题” | 再跑一次。如果还是失败，它就是 Bug。严禁忽略任何红色。 |
| “这些 console.log 留着以后调试方便” | 它们污染了生产日志。如果你需要日志，使用正规的 logger，而不是 console.log。 |
| “我不想 rebase，怕搞坏了” | 怕搞坏是因为你不懂 Git。学习它，掌握它。清晰的历史是团队的资产。 |
| “主干代码变动太大，我直接强推吧” | **绝对禁止。** 这会覆盖同事的工作。 |

## 危险信号 (Red Flags)

如果出现以下情况，**立即停止**集成流程：

- 你试图跳过测试，因为“我只改了一行代码”。
- `git status` 显示有未跟踪的临时文件。
- 你在提交信息里写了 “最终修复 (final fix)”。
- 你发现自己正在手动解决同一个文件的第 5 次冲突。