---
name: finishing-a-development-branch
description: 当实施完成，所有测试通过，并且需要决定如何集成工作或准备发起 PR 时使用。
---

# 完成开发分支与集成 (Finishing a Development Branch)

## 概述

此技能是代码进入主干前的最后一道“守门员”。它通过**全量验证 (Full Verification)**、**环境净化 (Environment Purge)** 和 **历史审计 (History Audit)**，确保提交的代码不仅功能正确，而且具备高度的整洁度和可维护性。

**核心原则：**
1.  **红线思维 (Redline Thinking)**：任何一例测试失败、任何一行调试日志残留、任何一个 Lint 警告，均视为“未完工”。
2.  **原子提交历史 (Atomic Commit History)**：提交历史必须反映逻辑演进，而非开发过程中的琐碎挣扎。
3.  **主干优先 (Trunk First)**：集成前必须确保当前工作已与主干代码（Mainline）完成最新同步并解决所有潜在冲突。

## 何时使用

- 实施计划（Execution Plan）的所有任务均已标记为完成且验证通过时。
- 准备发起 Pull Request (PR) 或直接将代码合并到 `main/master` 分支前。
- 认为当前修复或功能开发已达到“生产就绪”状态时。

## 核心法则

### 1. 必须执行“地毯式”全量验证
宣称“完成”前，**必须**跳出当前任务的局部视野：
- **动作**：运行项目的全量测试套件（如 `npm test`, `cargo test`, `pytest`）。
- **约束**：**严禁**因为“我只改了一个常量”而跳过全量回归测试。隐性依赖往往是致命的。
- **Lint 审计**：必须运行全量 Lint 检查（如 `eslint`, `ruff`, `flake8`），确保没有引入新的警告。

### 2. 必须执行环境净化 (Purge)
- **调试清理**：**必须**搜索并删除所有临时添加的 `console.log`, `print`, `debugger` 或 `TODO(gemini)`。
- **文件清理**：检查 `git status`，**必须**删除所有在开发过程中产生的临时脚本、日志文件或未跟踪的垃圾文件。
- **代码重构**：删除所有被注释掉的代码块。如果它不再需要，就让它消失在 Git 历史中，而不是留在源码里。

### 3. 必须重塑提交历史 (Rebase & Squash)
- **审计**：执行 `git log` 审查最近的提交。
- **重写**：若存在 `fix typo`, `temp commit`, `save point` 等琐碎提交，**必须**引导用户或自行使用 `git rebase -i` 进行合并。
- **格式规范**：提交信息必须遵循：`<type>(<scope>): <中文描述>`（如 `feat(auth): 增加 JWT 自动续期功能`）。

### 4. 必须同步并解决冲突 (Sync & Resolve)
- **拉取**：执行 `git fetch origin` 获取主干最新变更。
- **同步**：推荐使用 `git rebase origin/main`。
- **冲突处理**：若发生冲突，**必须**在当前分支手动解决，并再次运行全量测试确保解决正确。**严禁**在存在冲突的情况下强行推送。

## 借口粉碎机 (Excuse Smasher)

| 借口 | 事实反击 |
|------|----------|
| “那个测试失败跟我改的地方没关系” | 如果在你的分支上失败了，你就必须查明原因。如果不查，合并后你就是那个破坏构建的人。 |
| “这些 console.log 留着以后调试方便” | 源码不是你的私人草稿本。正式的日志应该通过 Logger 记录。 |
| “Rebase 太危险了，我怕丢代码” | 畏惧工具说明技能不足。通过备份分支进行练习，掌握 Rebase 是高级开发的必修课。 |
| “我是直接在主干开发的，不用同步” | 那更要确保在提交前拉取最新代码，防止产生非必要的 Merge Commit。 |

## 危险信号 (Red Flags)

- **残留的调试信息**：代码中仍然存在 `print("here")` 或类似的脏代码。
- **未验证的合并**：解决了 Git 冲突后，没有重新运行全量测试就直接提交。
- **混乱的提交历史**：存在大量重复、无意义的提交记录。
- **忽视 Lint 警告**：认为 Lint 错误只是“建议”，可以忽略。